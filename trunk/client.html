<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>client</title>
   <script type="text/javascript" src="prototype.js"></script>
</head>
<body>
	<iframe id="foo" name="foo" style="display:none"></iframe>
	
<form id="theForm" action="./server2.php" target="foo" onsubmit="comet.doRequest($('input').value)">
	<input type="text" name="input" value="" id="input">
	<input type="submit" id="submit" name="submit" value="submit">
</form>
	<script type="text/javascript">
	
		//Create the Comet "object"
		var Comet = Class.create();
		
		//Set the properties and methods of the class
		Comet.prototype = {
			url:'./server2.php',
			noerror:true,
			initialize: function(){},
			
			//Define the connection function
			connect:function()
				{
					//Create the AJAX object that inititiate the ajax connection
					this.ajax = new Ajax.Request(this.url, 
						{
							method:'get',
							//On a successful response 
							onSuccess:function(transport)
							{
								alert("Connection successful!");
								var response = transport.responseText;
								document.write("I, the client have received " + response);
							},
						
							//When the request is completed
							onComplete:function()
							{
								alert("complete method");
								//Immediately reconnect
								this.comet.connect();  //Connect immeidietly after disconnect (e.g. long polling!)
							},
							onInteractive:function(transport)
							{
//									alert("Got something.");
									alert(transport.responseText);
							},
							//If there is an error along the way
							onError:function()
							{
								alert("Error");
							}
						}
					);
					this.ajax.comet=this;
				
				},
				handleResponse: function(response)
			    {
			      $('content').innerHTML += '<div>' + response['msg'] + '</div>';
			    },
			  doRequest: function(request)
			    {
				var input = $('theForm').getInputs('text');
				alert("request is  " + request);
				$('theForm').request({
					method:'get',
					parameters:{input:request},
					onInteractive:function(transport){alert(transport.responseText);},
					onComplete:function(){this.comet.connect();}
				}
					)
				}
			}
/*			      new Ajax.Request('./server2.php', {
					method:'GET',
			        parameters: $('theForm').serialize(true)
			      });
				}*/	
					
//				alert("Create the comet instance");
		  var comet = new Comet();
//			alert("Call the connect method");
		comet.connect();
//		document.write("making initial request.");
	</script>

	
</body>
</html>

