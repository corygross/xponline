<html>
<head>
<script type="text/javascript">
// Global Declarations (so they are accessible to both main document and the inline frame)
var myIFrame;
var mainDoc;

var mouse_x_box;
var mouse_y_box;
var cursor_line_box;
var cursor_char_box;

var rawDoc = new Array();
var lastModifiedLine = 0;
var lastModifiedChar = 0;

function init() {
	myIFrame = document.getElementById("myI");
	mainDoc = document;
	
	mouse_x_box = document.getElementById("mX");
	mouse_y_box = document.getElementById("mY");
	cursor_line_box = document.getElementById("cL");
	cursor_char_box = document.getElementById("cC");	
	
	myIFrame.contentDocument.designMode = "on";
	myIFrame.contentWindow.document.addEventListener("mousemove",function(e){displayMousePos(e);highlightCursor();}, true);
	//myIFrame.contentWindow.document.addEventListener("click",highlightCursor, true);

	//*****Populate our data structure***********
	var curline = "";
	var nextline = 0;
	try {
	while (curline = myIFrame.contentWindow.document.getElementById("line"+nextline).innerHTML)
	{
		rawDoc.push(curline);
		nextline++;
	}
	}catch (e) {}
	//********** Done populating data structure **********
}

function displayCursorPos() {
	cursor_line_box.value = lastModifiedLine;
	cursor_char_box.value = lastModifiedChar;
}

function getMousePos(e) {
	return [e.pageX, e.pageY];
}

// Don't need this (yet?) 
//********** USELESS **********
//function getElementPos(element) {
//	var current_left = current_top = 0;
//	if (element.offsetParent) {
//		do {
//			current_left += element.offsetLeft;
//			current_top += element.offsetTop;
//		} while (element = element.offsetParent);
//	}
//
//	return [current_left,current_top];
//}
// ************* END USELESS ******************

function displayMousePos(e) {
	var mousePos = getMousePos(e);

	mouse_x_box.value = mousePos[0];
	mouse_y_box.value = mousePos[1];
}

function highlightCursor() {
	// Determine line # and ensure valid input
	var currow = Math.floor((mouse_y_box.value - 8)/16);
	if (currow > rawDoc.length) currow = rawDoc.length-1;
	var curcol = Math.floor((mouse_x_box.value - 8)/8);
	if (curcol < 0) curcol =0;
	if (curcol > rawDoc[currow].length) curcol = rawDoc[currow].length-1;
	
	// Make sure to clear cursor if we switched lines, and update current line
	if (lastModifiedLine != currow)
	{
		myIFrame.contentWindow.document.getElementById("line"+lastModifiedLine).innerHTML = rawDoc[lastModifiedLine];
	}
	else {}
	lastModifiedLine = currow;
	
	//Be more efficient
	if (lastModifiedChar != curcol)
	{
		// Perform cursor highlight operation
		var curline = new String(rawDoc[currow]);
		var lineArray = [curline.substr(0,curcol),curline.substr(curcol, 1),	curline.substr(curcol+1,curline.length-1)];
		lineArray[1] = lineArray[1].fontcolor("red");

		// display new formatting
		myIFrame.contentWindow.document.getElementById("line"+currow).innerHTML = lineArray.join("");

	} else {} // Do nothing if it's already highlighted
	lastModifiedChar = curcol;
	
	// Display current cursor position
	displayCursorPos();
		
}
</script>
</head>
<body onload="init()" >
<iframe id="myI" src="editableContent.html"></iframe><br />
line#:<input type="text" id="cL" />
col#:<input type="text" id="cC" /><br />
MouseX:<input type="text" id="mX" />
MouseY:<input type="text" id="mY" />
</body>
</html>